.\" Automatically generated by Pandoc 2.7.3
.\"
.TH "lpassh-add" "1" "January 11, 2020" "" ""
.hy
.SH NAME
.PP
\f[B]lpassh-add\f[R] - Unlocks SSH keys using LastPass
.SH SYNOPSIS
.PP
\f[B]lpassh-add\f[R] [\f[B]-cq\f[R]] [\f[B]-t\f[R] \f[I]LIFETIME\f[R]]
[\f[I]KEY\f[R] [\f[I]KEY\f[R] [...]]]
.PP
\f[B]lpassh-add\f[R] \f[B]-h\f[R]
.PP
\f[B]lpassh-add\f[R] \f[B]-V\f[R]
.SH DESCRIPTION
.PP
\f[B]lpassh-add\f[R] adds \f[B]KEY\f[R] to the SSH authentication agent,
just as \f[B]ssh-add\f[R] would, but looks up the passphrase for
\f[B]KEY\f[R] in LastPass.
If it can\[aq]t find it there, it calls \f[B]ssh-add\f[R].
.PP
If you don\[aq]t give any \f[B]KEY\f[R], it tries to add
\f[C]\[ti]/.ssh/id_rsa\f[R], \f[C]\[ti]/.ssh/id_dsa\f[R],
\f[C]\[ti]/.ssh/id_ecdsa\f[R], and \f[C]\[ti]/.ssh/id_ed25519\f[R],
ignoring those that don\[aq]t exist.
.PP
If you\[aq]re not logged into LastPass and \f[C]LPASSH_ADD_USERNAME\f[R]
is set, \f[B]lpassh-add\f[R] logs you into LastPass; it also logs you
out again when it\[aq]s done.
.SH OPTIONS
.PP
Most of these options are simply passed through to \f[B]ssh-add\f[R].
.TP
.B -c
Confirm every use of an identity.
Note, for this to work SSH_ASKPASS must be set when the SSH
authentication agent starts.
.TP
.B -h
Show help.
.TP
.B -q
Be quieter.
.TP
.B -t \f[B]LIFETIME\f[R]
Automatically re-lock keys after \f[B]LIFETIME\f[R].
.TP
.B -V
Show version.
.SH WHERE TO STORE PASSPHRASES IN LASTPASS
.PP
You need to store the passphrase for each of your private SSH keys in
the \[dq]Passphrase\[dq] field of a so-called Secure Note of the type
\[dq]SSH Key\[dq].
You also need to include \[dq]ssh\[dq] in the name of that Secure Note
or in the name of the folder that you place that note in.
.PP
You can change which Secure Notes and folders \f[B]lpassh-add\f[R] tries
by setting the environment variable \f[C]LPASSH_ADD_PATH_REGEX\f[R].
.PP
You can also make \f[B]lpassh-add\f[R] try \f[I]every\f[R] item in your
LastPass database to describe an SSH key, by setting
\f[C]LPASSH_ADD_PATH_REGEX\f[R] to the empty string (\[dq]\[dq]) or any
other regular expression that matches any string.
This is a \f[I]bad\f[R] idea.
It\[aq]s slow.
It will likely pass passphrases to \f[B]ssh-add\f[R] that are none of
its business.
And it will likely generate a lot of warnings; these are harmless,
however.
.SH ENVIRONMENT
.TP
.B LPASSH_ADD_PATH_REGEX
A basic regular expression.
\f[B]lpassh-add\f[R] assumes that any item in your LastPass database the
path of which matches this expression describes an SSH key.
If you set this variable to a regular expression that matches any
string, for instance, the empty string (\[dq]\[dq]), then
\f[B]lpassh-add\f[R] will assume that \f[I]every\f[R] item in your
LastPass database describes an SSH key.
This is a \f[I]bad\f[R] idea.
(Default if not set: \[dq]ssh\[dq].)
.TP
.B LPASSH_ADD_USERNAME
A LastPass username.
If set, \f[B]lpassh-add\f[R] uses this username to log you into LastPass
if you aren\[aq]t logged in already.
(Default if not set: Don\[aq]t log into LastPass.)
.TP
.B LPASSH_ADD_AGENT_DISABLE
0 (for false) or 1 (for true).
Whether \f[B]lpassh-add\f[R] should use the LastPass agent.
Any value other than 0 or 1 will be ignored.
(Default if not set: Respect \f[C]LPASS_AGENT_DISABLE\f[R].)
.TP
.B LPASS_ASKPASS
Utility to ask for passphrases.
Takes precedence over \f[C]SSH_ASKPASS\f[R].
(Default if not set: Ask on teletype device of your terminal.)
.TP
.B SSH_ASKPASS
Utility to ask for passphrases.
Only used if \f[C]LPASS_ASKPASS\f[R] \f[I]isn\[aq]t\f[R] set.
(Default if not set: Ask on teletype device of your terminal.)
.SH SECURITY
.PP
\f[B]lpassh-add\f[R] is but a shell script.
You should read the source code and assess the security risks yourself.
Above all, since \f[B]lpassh-add\f[R] is a wrapper around OpenSSH and
the LastPass command line client, their threat models apply.
.PP
\f[B]lpassh-add\f[R] trusts your system (i.e., your terminal, your
shell, the utilities it calls, etc.), OpenSSH, the LastPass command line
client, whatever utility you have set in \f[C]LPASS_ASKPASS\f[R] or
\f[C]SSH_ASKPASS\f[R], and your environment.
.PP
\f[B]lpassh-add\f[R] may, and likely will, pass the passphrases of
\f[I]all\f[R] LastPass itemes the path of which matches the regular
expression given in \f[C]LPASSH_ADD_PATH_REGEX\f[R] to
\f[B]ssh-add\f[R].
.PP
If you\[aq]re using the LastPass agent, any programme tbat you (or the
superuser) run can get a copy of your password database by calling
\f[C]lpass export\f[R] while the agent is running.
This conforms to LastPass\[aq] threat model, but it may make you feel
uneasy.
You can use \f[B]lpassh-add\f[R] \f[I]without\f[R] using the LastPass
agent, by setting \f[C]LPASSH_ADD_AGENT_DISABLE\f[R] or
\f[C]LPASS_AGENT_DISABLE\f[R] to 1.
\f[B]lpassh-add\f[R] will still only ask you for your LastPass password
once.
However, it will then store a copy of the LastPass master password in
memory while it\[aq]s running.
(If you\[aq]re using the LastPass agent, it won\[aq]t.)
.PP
If you do \f[I]not\f[R] set \f[C]LPASS_ASKPASS\f[R] or
\f[C]SSH_ASKPASS\f[R], \f[B]lpassh-add\f[R] will read passphrases from
the teletype device of your terminal.
However, it does \f[I]not\f[R] have exclusive access to that device; any
other process that you (or the superuser) runs can also read from that
device.
(This is true for \f[I]any\f[R] programme that reads data from a
teletype device, including \f[B]ssh-add\f[R].)
.SH EXIT STATUS
.TP
.B 0
Success.
.TP
.B 64
Usage error.
.TP
.B 69
Any other error.
.TP
.B 70
Bug.
.TP
.B > 128
Terminated by a signal.
.TP
.B Other non-zero status
Unexpected error.
.PP
\f[B]lpassh-add\f[R] may exit with other statuses on some systems or
when run by some shells (e.g., \f[B]zsh\f[R]).
However, you can safely assume that 0 indicates success and non-zero
failure.
.SH AUTHOR
.PP
Copyright 2018, 2019, 2020 Odin Kroeger
.SH SEE ALSO
.PP
\f[B]lpass\f[R](1), \f[B]ssh-add\f[R](1)
.PP
<https://github.com/odkr/lpassh-add>
